<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

  <script src=
  "https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="../htex-ress/clipboard.min.js"></script>
  <link rel="stylesheet" type="text/css" media="screen" href=
  "../htex-ress/basic-screen.css" />
  <link rel="stylesheet" type="text/css" media="printer" href=
  "../htex-ress/basic-printer.css" />
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii" />
  <title>TP 7 : Les fonctions de lecture du SGF</title>
  <link rel="stylesheet" type="text/css" href=
  "../blue40.screen.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="../blue40.print.css"
  media="print" />
</head>
<body>
  <div id="allPage">
    <div id="header">
      <span class="header-item" id="header-accueil"><a href=
      "../index.html">Accueil</a></span><span class="header-item"
      id="m26-java"><a href="../jee/index.html">Architecture
      JEE</a></span><span class="header-item"><a href=
      "../arch-app/index.html">Architecture des
      applications</a></span><span class="header-item" id=
      "m27-xml"><a href=
      "../xml/index.html">XML</a></span><span class="header-item"
      id="info13"><a href="../systeme/index.html">Syst&#232;me
      d'exploitation</a></span><span class="header-item" id=
      "header-docs"><a href=
      "../docs/index.html">Docs</a></span><span class="header-item"
      id="xdosicalu"><a href=
      "../dosicalu/index.html">DOSICALU</a></span><span class=
      "header-item" id="header-dil"><a href=
      "http://dii.univ-mrs.fr">D&#233;partement
      d'informatique</a></span><a href="../chercher.html" id=
      "header-search" name="header-search"></a>
    </div>
    <div id="leftFrame">
      <div id="menu">
        <a class="menu1 menu-normal" href=
        "index.html"><span>Accueil</span></a><a class=
        "menu1 menu-normal" href="#"><span>Sujets de
        TPs&#160;:</span></a><a class="menu2 menu-normal" href=
        "tp01-simul1.html"><span>1. CPU et
        multi-t&#226;ches</span></a><a class="menu2 menu-normal"
        href="tp02-simul2.html"><span>2.
        Entr&#233;es/sorties</span></a><a class="menu2 menu-normal"
        href="tp03-thread.html"><span>3. Threads &amp;
        s&#233;maphores</span></a><a class="menu2 menu-normal"
        href="tp04-philo.html"><span>4. Condition de
        synchronisation</span></a><a class="menu2 menu-normal"
        href="tp05-mem.html"><span>5. Gestion
        m&#233;moire</span></a><a class="menu2 menu-normal" href=
        "tp06-ipc.html"><span>6. Les IPC UNIX</span></a><a class=
        "menu2 menu-active" href="tp07-sgf.html"><span>7. Un mini
        SGF (1/2)</span></a><a class="menu2 menu-normal" href=
        "tp08-sgf.html"><span>8. Un mini SGF
        (2/2)</span></a><a class="menu1 menu-normal" href=
        "#"><span>Liens&#160;:</span></a><a class=
        "menu2 menu-normal" href=
        "https://formations.univ-amu.fr/ME3SIN-PRSIN3AA.html"><span>&gt;&#160;Licence
        d'Info.</span></a><a class="menu2 menu-normal" href=
        "http://ametice.univ-amu.fr/course/view.php?id=30983"><span>&gt;&#160;AMETICE</span></a>
      </div>
      <div id="printable">
        <a href="tp07-sgf.pdf">Version PDF</a>
      </div>
    </div>
    <div id="content">
      <h1 id="idhtex-h1-1">TP 7 : Les fonctions de lecture du
      SGF</h1>
      <div id="table-of-contents">
        <div class="table-of-contents-title">
          &#160;Sommaire
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#idhtex-h2-1">Programmation d'un mini
          S.G.F.</a>
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#idhtex-h2-2">Explication du codage
          choisi</a>
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#idhtex-h2-3">Lister le
          r&#233;pertoire</a>
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#idhtex-h2-4">Lecture dans un
          fichier</a>
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#idhtex-h2-5">Acc&#232;s direct en
          lecture</a>
        </div>
      </div>
      <blockquote>
        <div>
          <span class="htex-DANGER">Les TP 7 ET 8 sont &#224;
          rendre<br clear="none" />
          ensemble sur <a target="_blank" href=
          "http://ametice.univ-amu.fr/course/view.php?id=30983"
          shape="rect">AMETICE</a> avant le 21
          d&#233;cembre.</span>
        </div>
      </blockquote>
      <h2 id="idhtex-h2-1">Programmation d'un mini S.G.F.</h2>
      <p>Nous allons, pendant deux s&#233;ances de travaux
      pratiques, reconstruire les fonctions d'un S.G.F. tr&#232;s
      simplifi&#233;.</p>
      <ul>
        <li>Commencez par r&#233;cup&#233;rer <a href=
        "mini-sgf.zip" shape="rect">les sources de ce mini
        SGF</a>.</li>
        <li>Le projet est organis&#233; de la mani&#232;re
        suivante&#160;:
          <ul>
            <li><span class="htex-ttt">sgf-header.h</span> :
            structures de donn&#233;es et prototypes des fonctions
            du SGF (<span class="htex-IMP">complet</span>).</li>
            <li><span class="htex-ttt">sgf-disk.c</span> :
            entr&#233;e/sortie de blocs vers le disque simul&#233;
            par le fichier <span class="htex-ttt">disk0</span>
            (<span class="htex-IMP">complet</span>).</li>
            <li><span class="htex-ttt">sgf-fat.c</span> : gestion
            de la FAT en m&#233;moire et sur disque (<span class=
            "htex-IMP">complet</span>).</li>
            <li><span class="htex-ttt">sgf-dir.c</span> :
            lecture/&#233;criture des couples (nom,adr-i-node) dans
            le r&#233;pertoire (<span class=
            "htex-DANGER">incomplet</span>).</li>
            <li><span class="htex-ttt">sgf-io.c</span> :
            op&#233;rations
            d'ouverture/lecture/&#233;criture/fermeture des
            fichiers (<span class=
            "htex-DANGER">incomplet</span>).</li>
            <li><span class="htex-ttt">sgf-impl.o</span> :
            Implantation des fonctions &#224; terminer
            (<span class="htex-IMP">code&#160;C non
            fourni</span>).</li>
          </ul>
        </li>
      </ul>
      <h2 id="idhtex-h2-2">Explication du codage choisi</h2>
      <p>Commencez par &#233;tudier le fichier <span class=
      "htex-ttt">sgf-header.h</span>. Il regroupe toutes les
      d&#233;finitions des structures et des fonctions. Il permet
      de comprendre la structure choisie pour coder le
      r&#233;pertoire, le cha&#238;nage des blocs et les fichiers
      sur notre disque simul&#233;.</p>
      <p>Le sch&#233;ma ci-dessous d&#233;taille un disque de huit
      blocs (0 &#224; 7) qui comporte un fichier (<span class=
      "htex-ttt">hello.txt</span>) compos&#233; de deux blocs
      (<span class="htex-ttt">D1</span> et <span class=
      "htex-ttt">D2</span>) rang&#233;s respectivement dans le bloc
      physique 3 et le bloc physique 7. Le descripteur de ce
      fichier se trouve dans le bloc physique 5. On trouve
      l'adresse du descripteur dans le r&#233;pertoire. Le
      r&#233;pertoire est toujours dans le bloc 0 suivi de la
      FAT.</p>
      <div style="text-align:center">
        <span class="htex-img"><img src="figures/sgf.png" class=
        "htex-img htex-width-8cm" alt=
        "Figure figures/sgf" /></span>
      </div>
      <h2 id="idhtex-h2-3">Lister le r&#233;pertoire</h2>
      <p>Programmez la fonction <span class=
      "htex-ttt">list_directory</span> du fichier <span class=
      "htex-ttt">sgf-dir.c</span> sans faire appel &#224; la
      version <span class="htex-ttt">_impl</span> (des explications
      sont disponibles dans le commentaire).</p>
      <p>Vous pouvez utiliser la commande <span class=
      "htex-ttt">format</span> livr&#233;e avec le projet pour
      fabriquer un disque vierge avec plusieurs fichiers de test
      plac&#233;s &#224; l'int&#233;rieur.</p>
      <h2 id="idhtex-h2-4">Lecture dans un fichier</h2>
      <p>La lecture se d&#233;roule en trois &#233;tapes&#160;:</p>
      <ol type="1">
        <li>ouverture du fichier en lecture (&#233;tudiez la
        fonction <span class="htex-ttt">sgf_open_read</span> du
        fichier <span class="htex-ttt">sgf-io.c</span>)</li>
        <li>lecture d'un caract&#232;re dans le buffer (fonction
        <span class="htex-ttt">sgf_getc</span>)</li>
        <li>lecture d'un bloc pour remplir le buffer (fonction
        <span class="htex-ttt">sgf_read_block</span>)</li>
      </ol>
      <p>Commencez par programmer la fonction <span class=
      "htex-ttt">sgf_getc</span> disponible dans le fichier
      <span class="htex-ttt">sgf-io.c</span>. Des explications sont
      disponibles dans le commentaire. V&#233;rifiez le bon
      fonctionnement avant de passer &#224; la fonction
      suivante.</p>
      <p>Continuez avec la fonction <span class=
      "htex-ttt">sgf_read_block</span> et testez son bon
      fonctionnement.</p>
      <h2 id="idhtex-h2-5">Acc&#232;s direct en lecture</h2>
      <p>On vous demande de r&#233;aliser la fonction <span class=
      "htex-ttt">sgf_seek</span> qui r&#233;alise le
      d&#233;placement du pointeur <span class=
      "htex-ttt">ptr</span> en lecture. Pour ce faire, suivez les
      &#233;tapes ci-dessous&#160;:</p>
      <ol type="1">
        <li>Ajoutez au fichier <span class=
        "htex-ttt">sgf-header.h</span> la d&#233;claration suivante
          <div>
            <div class="htex-code htex-copy prettyprint lang-c">
              <div class="htex-copy-button">
                <button class="htex-copy-button"
                data-clipboard-target="#idm170" type=
                "submit"><img width="16" alt="" src=
                "../htex-ress/clippy.svg" /></button>
              </div>
              <pre xml:space="preserve" id="idm170" class=
              "htex-code htex-copy prettyprint lang-c">
int sgf_seek(OFILE* f, int pos);
</pre>
            </div>
          </div>
        </li>
        <li>Ajoutez l'implantation de cette fonction dans le
        fichier <span class="htex-ttt">sgf-io.c</span>. Cette
        fonction va d&#233;placer le pointeur associ&#233; au
        fichier ouvert (<span class="htex-ttt">ptr</span> donc) en
        utilisant le deuxi&#232;me param&#232;tre. Si la position
        demand&#233;e n'est pas un multiple de la taille des blocs,
        alors le bloc en question devra &#234;tre charg&#233; dans
        le tampon (fonction <span class=
        "htex-ttt">sgf_read_block</span>). <span class=
        "htex-IMP">Attention</span>&#160;: prenez soin de limiter
        la lecture de bloc notamment quand la nouvelle position
        concerne le m&#234;me bloc que la position
        pr&#233;c&#233;dente. Cette fonction renvoie 0 en cas de
        succ&#232;s et -1 sinon.</li>
        <li>Testez cette fonction en lisant, dans un fichier, les
        caract&#232;res dont la position est multiple de 1.</li>
        <li>Testez &#224; nouveau avec une position multiple de
        8.</li>
      </ol>
    </div>
  </div>
  <script src="../htex-ress/init.js"></script>
</body>
</html>
