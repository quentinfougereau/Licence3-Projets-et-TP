#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/shm.h>

typedef struct {
    int the_char;        /* '\0' si vide           */
    int end;             /* signal de fin d'entrée */
} BUFFER;

int main(void) {
  BUFFER *b;
  int memid;
  key_t key;

  key = ftok("/home/quentin", 67);
  printf("%d\n", key);

  /* création ou lien avec la zone partagée */
  memid = shmget(key, sizeof(BUFFER), 0700 | IPC_CREAT);
  if (memid == -1) { perror("shmget"); return (EXIT_FAILURE); }

  /* montage en mémoire */
  b = shmat(memid, NULL, 0);

  while (scanf("%d", &b->the_char) != EOF) {
    printf("Vous avez entré %d\n", b->the_char);
    sleep(1);
  }

  return (EXIT_SUCCESS);

}
