<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

  <script src=
  "https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="../htex-ress/clipboard.min.js"></script>
  <link rel="stylesheet" type="text/css" media="screen" href=
  "../htex-ress/basic-screen.css" />
  <link rel="stylesheet" type="text/css" media="printer" href=
  "../htex-ress/basic-printer.css" />
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii" />
  <title>TP3&#160;: Threads et s&#233;maphores</title>
  <link rel="stylesheet" type="text/css" href=
  "../blue40.screen.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="../blue40.print.css"
  media="print" />
</head>
<body>
  <div id="allPage">
    <div id="header">
      <span class="header-item" id="header-accueil"><a href=
      "../index.html">Accueil</a></span><span class="header-item"
      id="m26-java"><a href="../jee/index.html">Architecture
      JEE</a></span><span class="header-item"><a href=
      "../arch-app/index.html">Architecture des
      applications</a></span><span class="header-item" id=
      "m27-xml"><a href=
      "../xml/index.html">XML</a></span><span class="header-item"
      id="info13"><a href="../systeme/index.html">Syst&#232;me
      d'exploitation</a></span><span class="header-item" id=
      "header-docs"><a href=
      "../docs/index.html">Docs</a></span><span class="header-item"
      id="xdosicalu"><a href=
      "../dosicalu/index.html">DOSICALU</a></span><span class=
      "header-item" id="header-dil"><a href=
      "http://dii.univ-mrs.fr">D&#233;partement
      d'informatique</a></span><a href="../chercher.html" id=
      "header-search" name="header-search"></a>
    </div>
    <div id="leftFrame">
      <div id="menu">
        <a class="menu1 menu-normal" href=
        "index.html"><span>Accueil</span></a><a class=
        "menu1 menu-normal" href="#"><span>Sujets de
        TPs&#160;:</span></a><a class="menu2 menu-normal" href=
        "tp01-simul1.html"><span>1. CPU et
        multi-t&#226;ches</span></a><a class="menu2 menu-normal"
        href="tp02-simul2.html"><span>2.
        Entr&#233;es/sorties</span></a><a class="menu2 menu-active"
        href="tp03-thread.html"><span>3. Threads &amp;
        s&#233;maphores</span></a><a class="menu2 menu-normal"
        href="tp04-philo.html"><span>4. Condition de
        synchronisation</span></a><a class="menu2 menu-normal"
        href="tp05-mem.html"><span>5. Gestion
        m&#233;moire</span></a><a class="menu2 menu-normal" href=
        "tp06-ipc.html"><span>6. Les IPC UNIX</span></a><a class=
        "menu2 menu-normal" href="tp07-sgf.html"><span>7. Un mini
        SGF (1/2)</span></a><a class="menu2 menu-normal" href=
        "tp08-sgf.html"><span>8. Un mini SGF
        (2/2)</span></a><a class="menu1 menu-normal" href=
        "#"><span>Liens&#160;:</span></a><a class=
        "menu2 menu-normal" href=
        "https://formations.univ-amu.fr/ME3SIN-PRSIN3AA.html"><span>&gt;&#160;Licence
        d'Info.</span></a><a class="menu2 menu-normal" href=
        "http://ametice.univ-amu.fr/course/view.php?id=30983"><span>&gt;&#160;AMETICE</span></a>
      </div>
      <div id="printable">
        <a href="tp03-thread.pdf">Version PDF</a>
      </div>
    </div>
    <div id="content">
      <h1 id="idhtex-h1-1">TP3&#160;: Threads et
      s&#233;maphores</h1>
      <div id="table-of-contents">
        <div class="table-of-contents-title">
          &#160;Sommaire
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#thread">Utilisation des
          <i>threads</i> Linux</a>
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#sysc">Utilisation des
          s&#233;maphores</a>
        </div>
        <div class="table-of-contents-level1">
          &gt;&#160;<a href="#prod-conso">S&#233;maphore,
          producteur et consommateur</a>
        </div>
        <div class="table-of-contents-level2">
          &gt;&#160;<a href="#idhtex-h3-1">Un tampon de un
          caract&#232;re</a>
        </div>
        <div class="table-of-contents-level2">
          &gt;&#160;<a href="#idhtex-h3-2">Un tampon
          r&#233;aliste</a>
        </div>
      </div>
      <h2 id="thread">Utilisation des <i>threads</i> Linux</h2>
      <ul>
        <li>Commencez par lire cette <a href="../docs/thread.html"
        shape="rect">petite documentation sur les threads</a> et
        faites tourner le programme fourni en exemple. Vous pouvez
        utiliser la commande <span class="htex-ttt">ps -eLf</span>
        pour observer les <i>threads</i> cr&#233;&#233;s par cet
        exemple.</li>
        <li>V&#233;rifiez la consommation de CPU en utilisant la
        commande <span class="htex-ttt">time
        non_de_votre_commande</span>.</li>
        <li>Diminuez cette consommation de CPU en utilisant la
        fonction <span class="htex-ttt">usleep(100)</span> dans les
        boucles d'attente et v&#233;rifiez le r&#233;sultat.</li>
      </ul>
      <h2 id="sysc">Utilisation des s&#233;maphores</h2>
      <p>Commencez par lire cette <a href="../docs/thread-sem.html"
      shape="rect">petite documentation sur les s&#233;maphores</a>
      et faites tourner le programme fourni en exemple.</p>
      <p><span class="htex-IMP">Travail &#224;
      faire</span>&#160;:</p>
      <ul>
        <li>V&#233;rifier que le m&#233;canisme d'exclusion
        mutuelle est bien n&#233;cessaire (commentez l'appel des
        fonctions <span class="htex-ttt">sem_wait</span> et
        <span class="htex-ttt">sem_post</span>).</li>
        <li>Si vous supprimez l'appel &#224; <span class=
        "htex-ttt">usleep(1)</span> quel est le
        r&#233;sultat&#160;? Avez-vous une explication&#160;?</li>
      </ul>
      <h2 id="prod-conso">S&#233;maphore, producteur et
      consommateur</h2>
      <h3 id="idhtex-h3-1">Un tampon de un caract&#232;re</h3>
      <p>Reprenez le premier exemple des threads et remplacez le
      drapeau <span class="htex-ttt">job</span> par deux
      s&#233;maphores pour implanter un sch&#233;ma producteur
      consommateur (le tampon est constitu&#233; d'un seul
      caract&#232;re). Rappel du sch&#233;ma
      producteur/consommateur&#160;:</p>
      <div>
        <div class="htex-code">
          <pre xml:space="preserve" id="idm111" class="htex-code">
  NPlein : s&#233;maphore := (0, {});
  NVide  : s&#233;maphore := (n, {});  // Taille du tampon
</pre>
        </div>
      </div>
      <table summary="" style=
      "width:100%;background-color:transparent;" border="0">
        <col width="48%" span="1" />
        <col width="4%" span="1" />
        <col width="48%" span="1" />
        <tr>
          <td style="background-color:transparent;" valign="top"
          rowspan="1" colspan="1">
            <div>
              Algorithme du producteur :
              <div>
                <div class="htex-code">
                  <pre xml:space="preserve" id="idm122" class=
                  "htex-code">
Pour toujours faire
    P(NVide);
    &lt; produire &gt;
    &lt; d&#233;poser dans le tampon &gt;
    V(NPlein);
Fin-pour
</pre>
                </div>
              </div>
            </div>
          </td>
          <td style="background-color:transparent;" rowspan="1"
          colspan="1">&#160;</td>
          <td style="background-color:transparent;" valign="top"
          rowspan="1" colspan="1">
            <div>
              Algorithme du consommateur :
              <div>
                <div class="htex-code">
                  <pre xml:space="preserve" id="idm129" class=
                  "htex-code">
Pour toujours faire
    P(NPlein);
    &lt; retirer du tampon &gt;
    &lt; consommer &gt;
    V(NVide);
Fin-pour
</pre>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </table>
      <h3 id="idhtex-h3-2">Un tampon r&#233;aliste</h3>
      <p>Modifiez l'exemple pr&#233;c&#233;dent pour avoir
      maintenant un tampon d'une dizaine de caract&#232;res.</p>
      <div>
        <div class="htex-code htex-copy prettyprint lang-c">
          <div class="htex-copy-button">
            <button class="htex-copy-button" data-clipboard-target=
            "#idm137" type="submit"><img width="16" alt="" src=
            "../htex-ress/clippy.svg" /></button>
          </div>
          <pre xml:space="preserve" id="idm137" class=
          "htex-code htex-copy prettyprint lang-c">
#define BUFFER_SIZE         (10)
char buffer[ BUFFER_SIZE ];
int ptr_input = 0;
int ptr_output = 0;
</pre>
        </div>
      </div>
      <p>La variable <span class="htex-ttt">ptr_input</span> donne
      l'indice de la prochaine case vide du tampon tandis que
      <span class="htex-ttt">ptr_output</span> donne l'indice de la
      prochaine case pleine. Ces variables sont g&#233;r&#233;es
      comme des pointeurs circulaires.</p>
      <p>Prenez soin de ralentir le producteur (avec <span class=
      "htex-ttt">sleep</span>) puis dans un deuxi&#232;me temps le
      consommateur pour tester tous les cas de figure (tampon vide
      ou tampon plein).</p>
    </div>
  </div>
  <script src="../htex-ress/init.js"></script>
</body>
</html>
