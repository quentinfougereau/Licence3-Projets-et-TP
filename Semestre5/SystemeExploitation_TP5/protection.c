#include <sys/types.h>
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <sys/mman.h>
#include <malloc.h>

int* alloc;
char* buffer;

/**************************************************
 Afficher la carte m√©moire du processus
 fichier /proc/self/maps
 **************************************************/
void dump_maps(void) {
    FILE *f;
    int c;

    f = fopen("/proc/self/maps", "r");
    assert(f != NULL);
    while ((c = fgetc(f)) != EOF) {
        putchar(c);
    }
    fclose(f);
    getchar();
}

int main(int argc, char* argv[]) {

  int pagesize = sysconf(_SC_PAGE_SIZE);
  buffer = memalign(pagesize, pagesize * 4);

  if (mprotect(buffer + pagesize * 1, pagesize * 2, PROT_READ) == -1)
      perror("mprotect");

  //Impossible d'ecrire car droit de lecture seuelement
  buffer[pagesize] = 0;
  //printf("%d\n", buffer[pagesize]);

  dump_maps();

  return (EXIT_SUCCESS);

}
